<!DOCTYPE html><html lang="en-gb"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>How to experience CP/M-80 2.2 using MAME&#x27;s Sharp X1 emulation? - VirtualHub</title><meta name="description" content="CP/M-80 was a popular operating system. Each release was customized by OEMs specifically for their hardware. This tutorial features the Sharp X1 version,"><meta name="generator" content="Publii Open-Source CMS for Static Site"><meta name="theme-color" content="#208509" media="(prefers-color-scheme: dark)"><meta name="theme-color" content="#208509" media="(prefers-color-scheme: light)"><meta name="msapplication-navbutton-color" content="#208509"><meta name="apple-mobile-web-app-status-bar-style" content="#208509"><link rel="canonical" href="https://virtualhub.eu.org/how-to-experience-cpm-80-22-using-mames-sharp-x1-emulation/"><link rel="alternate" type="application/atom+xml" href="https://virtualhub.eu.org/feed.xml"><link rel="alternate" type="application/json" href="https://virtualhub.eu.org/feed.json"><meta property="og:title" content="How to experience CP/M-80 2.2 using MAME's Sharp X1 emulation?"><meta property="og:image" content="https://virtualhub.eu.org/media/posts/7/CPM-80-2.2-MAME-x1-5-2.png"><meta property="og:site_name" content="VirtualHub"><meta property="og:description" content="CP/M-80 was a popular operating system. Each release was customized by OEMs specifically for their hardware. This tutorial features the Sharp X1 version,"><meta property="og:url" content="https://virtualhub.eu.org/how-to-experience-cpm-80-22-using-mames-sharp-x1-emulation/"><meta property="og:type" content="article"><meta property="fb:app_id" content="382780246752664"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@InstallerLegacy"><meta name="twitter:title" content="How to experience CP/M-80 2.2 using MAME's Sharp X1 emulation?"><meta name="twitter:description" content="CP/M-80 was a popular operating system. Each release was customized by OEMs specifically for their hardware. This tutorial features the Sharp X1 version,"><meta name="twitter:image" content="https://virtualhub.eu.org/media/posts/7/CPM-80-2.2-MAME-x1-5-2.png"><link rel="shortcut icon" href="https://virtualhub.eu.org/media/website/favicon.ico" type="image/x-icon"><link rel="shortcut icon" href="https://virtualhub.eu.org/media/website/favicon.ico" type="image/x-icon"><link rel="stylesheet" href="https://virtualhub.eu.org/assets/css/style.css?v=6aea5de6cc3ac869e11b57a637fb63ab"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://virtualhub.eu.org/how-to-experience-cpm-80-22-using-mames-sharp-x1-emulation/"},"headline":"How to experience CP/M-80 2.2 using MAME's Sharp X1 emulation?","datePublished":"2022-03-27T12:00","dateModified":"2022-04-08T14:00","image":{"@type":"ImageObject","url":"https://virtualhub.eu.org/media/posts/7/CPM-80-2.2-MAME-x1-5-2.png","height":571,"width":730},"description":"CP/M-80 was a popular operating system. Each release was customized by OEMs specifically for their hardware. This tutorial features the Sharp X1 version,","author":{"@type":"Person","name":"Legacy Installer","url":"https://virtualhub.eu.org/authors/legacy-installer/"},"publisher":{"@type":"Organization","name":"Legacy Installer"}}</script></head><body><header class="header" id="js-header"><a href="https://virtualhub.eu.org/" class="logo">VirtualHub</a><nav class="navbar js-navbar"><button class="navbar__toggle js-toggle" aria-label="Menu"><span class="navbar__toggle-box"><span class="navbar__toggle-inner">Menu</span></span></button><ul class="navbar__menu"><li><a href="https://virtualhub.eu.org/" target="_self">Home</a></li><li><a href="https://virtualhub.eu.org/about-virtualhub/" target="_self">About</a></li><li><a href="https://legacyinstaller.pcriot.com/contact" target="_self">Contact</a></li><li><a href="https://virtualhub.eu.org/downloads/" target="_self">Downloads</a></li><li class="active-parent has-submenu"><span class="is-separator" aria-haspopup="true">Start Here</span><ul class="navbar__submenu level-2" aria-hidden="true"><li class="active-parent has-submenu"><span class="is-separator" aria-haspopup="true">CP/M &amp; DOS</span><ul class="navbar__submenu level-3" aria-hidden="true"><li class="active-parent has-submenu"><span class="is-separator" aria-haspopup="true">CP/M</span><ul class="navbar__submenu level-4" aria-hidden="true"><li class="active-parent has-submenu"><span class="is-separator" aria-haspopup="true">CP/M-80</span><ul class="navbar__submenu level-5" aria-hidden="true"><li><a href="https://virtualhub.eu.org/how-to-experience-cpm-80-14/" target="_self">CP/M-80 1.4</a></li><li class="active-parent has-submenu"><span class="is-separator" aria-haspopup="true">CP/M-80 2.2</span><ul class="navbar__submenu level-6" aria-hidden="true"><li><a href="https://virtualhub.eu.org/how-to-experience-cpm-80-22/" target="_self">Altair Z80 Emulator</a></li><li class="active-parent has-submenu"><span class="is-separator" aria-haspopup="true">MAME</span><ul class="navbar__submenu level-7" aria-hidden="true"><li><a href="https://virtualhub.eu.org/how-to-experience-cpm-80-22-using-mame-kaypro-ii-emulation/" target="_self">KAYPRO II</a></li><li class="active"><a href="https://virtualhub.eu.org/how-to-experience-cpm-80-22-using-mames-sharp-x1-emulation/" target="_self">Sharp X1</a></li><li><a href="https://virtualhub.eu.org/how-to-experience-cpm-80-22-using-mames-ncr-decision-mate-v-emulation/" target="_self">NCR Decision Mate V</a></li></ul></li></ul></li><li><a href="https://virtualhub.eu.org/how-to-experience-cpm-80-30/" target="_self">CP/M-80 3.0</a></li></ul></li><li class="has-submenu"><span class="is-separator" aria-haspopup="true">CP/M-68k</span><ul class="navbar__submenu level-5" aria-hidden="true"><li><a href="https://virtualhub.eu.org/how-to-experience-cpm-68k/" target="_self">Altair Z80 Emulator</a></li><li><a href="https://virtualhub.eu.org/how-to-experience-cpm-68k-using-musashi-simulator/" target="_self">Musashi Simulator</a></li></ul></li><li><a href="https://virtualhub.eu.org/how-to-use-mpm-ii/" target="_self">MP/M II</a></li></ul></li><li class="has-submenu"><span class="is-separator" aria-haspopup="true">DOS</span><ul class="navbar__submenu level-4" aria-hidden="true"><li><a href="https://virtualhub.eu.org/how-to-experience-86-dos/" target="_self">86-DOS</a></li><li class="has-submenu"><span class="is-separator" aria-haspopup="true">MS DOS</span><ul class="navbar__submenu level-5" aria-hidden="true"><li class="has-submenu"><span class="is-separator" aria-haspopup="true">MS DOS 1.25</span><ul class="navbar__submenu level-6" aria-hidden="true"><li><a href="https://virtualhub.eu.org/how-to-install-ms-dos-125-on-86box/" target="_self">86Box</a></li><li><a href="https://virtualhub.eu.org/how-to-install-ms-dos-125-on-dosbox/" target="_self">DOSBox</a></li><li><a href="https://virtualhub.eu.org/how-to-install-ms-dos-125-on-dosbox-x/" target="_self">DOSBox-X</a></li><li><a href="https://virtualhub.eu.org/how-to-install-ms-dos-125-on-dosbox-staging/" target="_self">DOSBox-Staging</a></li><li><a href="https://virtualhub.eu.org/how-to-install-ms-dos-125-on-mame/" target="_self">MAME</a></li><li><a href="https://virtualhub.eu.org/how-to-install-ms-dos-125-on-virtualbox/" target="_self">VirtualBox</a></li><li><a href="https://virtualhub.eu.org/how-to-install-ms-dos-125-on-pcem/" target="_self">PCem</a></li></ul></li></ul></li><li class="has-submenu"><span class="is-separator" aria-haspopup="true">IBM PC DOS</span><ul class="navbar__submenu level-5" aria-hidden="true"><li class="has-submenu"><span class="is-separator" aria-haspopup="true">PC DOS 1.10</span><ul class="navbar__submenu level-6" aria-hidden="true"><li><a href="https://virtualhub.eu.org/how-to-install-pc-dos-110-on-86box/" target="_self">86Box</a></li><li><a href="https://virtualhub.eu.org/how-to-install-pc-dos-110-on-dosbox/" target="_self">DOSBox</a></li><li><a href="https://virtualhub.eu.org/how-to-install-pc-dos-110-on-dosbox-x/" target="_self">DOSBox-X</a></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></nav><div class="search"><div class="search__overlay js-search-overlay"><form action="https://virtualhub.eu.org/search.html" class="search__form"><input class="search__input" type="search" name="q" placeholder="search..." aria-label="search..."> <button type="submit" class="search__button"><span>SEARCH</span></button></form></div><button class="search__btn js-search-btn" aria-label="Search"><svg role="presentation" focusable="false" height="18" width="18"><use xlink:href="https://virtualhub.eu.org/assets/svg/svg-map.svg#search"/></svg></button></div></header><main><div class="wrapper"><article class="post"><header class="post__header"><a href="https://virtualhub.eu.org/tags/cpm/" class="post__maintag">CP/M</a><h1 class="post__title">How to experience CP/M-80 2.2 using MAME&#x27;s Sharp X1 emulation?</h1><div class="post__meta"><div class="post__author">By <a href="https://virtualhub.eu.org/authors/legacy-installer/" class="invert" rel="author" title="Legacy Installer">Legacy Installer</a></div><time datetime="2022-03-27T12:00">March 27, 2022</time><div class="post__comments"><a href="https://virtualhub.eu.org/how-to-experience-cpm-80-22-using-mames-sharp-x1-emulation/#comments" rel="nofollow" aria-label="Comments"><svg aria-hidden="true"><title>Comments</title><use xlink:href="https://virtualhub.eu.org/assets/svg/svg-map.svg#comments"/></svg></a></div></div></header><figure class="post__featured-image"><img src="https://virtualhub.eu.org/media/posts/7/CPM-80-2.2-MAME-x1-5-2.png" srcset="https://virtualhub.eu.org/media/posts/7/responsive/CPM-80-2.2-MAME-x1-5-2-xs.png 300w, https://virtualhub.eu.org/media/posts/7/responsive/CPM-80-2.2-MAME-x1-5-2-sm.png 480w, https://virtualhub.eu.org/media/posts/7/responsive/CPM-80-2.2-MAME-x1-5-2-md.png 768w, https://virtualhub.eu.org/media/posts/7/responsive/CPM-80-2.2-MAME-x1-5-2-lg.png 1200w" sizes="(min-width: 56.25em) 100vw, (min-width: 37.5em) 50vw, 100vw" loading="eager" height="571" width="730" alt="List of FIles in Sharp X1 CP/M-80 2.2"></figure><div class="post__inner"><div class="post__entry"><p>In the last tutorial, we saw <a href="https://virtualhub.eu.org/how-to-experience-cpm-80-22-using-mame-kaypro-ii-emulation/" target="_blank" rel="noopener noreferrer">how to experience CP/M-80 2.2 using MAME's KAYPRO II emulation</a>.Â There are three system on which we can run CP/M-80 2.2:</p><ul><li>KAYPRO II</li><li>NCR Decision Mate V</li><li>Sharp X1</li></ul><p>In this tutorial, we are going to use the SHARP X1 emulation. You can download the files required for this tutorial from here:</p><ul><li><a href="https://archive.org/download/cpm-80-2.2-sharp-x-1/CPM-80%202.2%20%5BSharp%20X1%5D%20%285.25-DSDD%29.7z">CP/M-80 2.2 for Sharp X1 disk image files</a></li><li><a href="https://archive.org/download/mame-merged/mame-merged/x1.zip">MAME Sharp X1 ROM</a></li><li><a href="https://virtualhub.eu.org/media/files/mame.ini.linux.tar.xz" download>mame.ini file for Linux</a></li><li><a href="https://virtualhub.eu.org/media/files/mame.ini.windows.zip" download>mame.ini file for Windows</a></li></ul><h2>Installing CP/M-80 2.2</h2><p>First you need to make sure you have installed MAME. For windows, see our tutorial on Legacy Installer onÂ <a href="https://legacyinstaller.pcriot.com/vm-software/mame" target="_blank" rel="noopener noreferrer">how to install MAME on Windows</a>. For linux, you can install mame from the official repository of your distribution. SeeÂ <a href="https://pkgs.org/download/mame" target="_blank" rel="noopener noreferrer">this page</a> for a list of <span style="font-weight: 400;">distributions</span> offering the package. If your distribution does not include mame in its repositories (highly unlikely), you can <a href="https://docs.mamedev.org/initialsetup/compilingmame.html" target="_blank" rel="noopener noreferrer">build MAME from source</a>.</p><p>After you have installed MAME, you need to create a folder in which all the files related to the emulator will reside. Open a Terminal/Command Prompt window and move to that folder. Then run:</p><pre>mame -cc</pre><p>You may need to specify the path to MAME if you are on Windows:</p><pre>"C:\Program Files\MAME\mame.exe" -cc</pre><p>This command will create some basic config files for MAME in that folder. Now open the folder in your File Manager and delete the <code>mame.ini</code>Â file. Extract theÂ <code>mame.ini</code>Â file from the archive you downloaded above according to your platform and copy it to the folder in which you are storing all the files related to the emulator. Create a folder calledÂ <code>roms</code> in that folder. Copy the ROMs archive to that folder. Do not extract the ROMs from the zip file. Move the zip files without extracting to the <code>roms</code>Â folder.</p><p>Extract the disk image archive and copy theÂ <code>Images/ImageDisk/disk01.imd</code> file to the folderÂ where you are storing all the files related to the emulator.</p><p>Now switch back to the terminal and run:</p><pre>mame x1</pre><p>You need to prefixÂ <code>mame</code> with the path on Windows as shown above. The mame window should open like this:</p><figure class="post__image post__image--center"><img decoding="async" loading="lazy" src="https://virtualhub.eu.org/media/posts/7//CPM-80-2.2-MAME-x1-1.png" sizes="(max-width: 48em) 100vw, 100vw" srcset="https://virtualhub.eu.org/media/posts/7//responsive/CPM-80-2.2-MAME-x1-1-xs.png 300w, https://virtualhub.eu.org/media/posts/7//responsive/CPM-80-2.2-MAME-x1-1-sm.png 480w, https://virtualhub.eu.org/media/posts/7//responsive/CPM-80-2.2-MAME-x1-1-md.png 768w" alt="MAME's X1 emulation window" width="743" height="576"></figure><p>If the window does not open and you get a ROM not found or similar error, see the troubleshooting section below. Press any key to continue. The emulation of this machine is not perfect. You will be informed about this by MAME. Press any key to continue. Wait until you get to this screen:</p><figure class="post__image post__image--center"><img decoding="async" loading="lazy" src="https://virtualhub.eu.org/media/posts/7/CPM-80-2.2-MAME-x1-2.png" sizes="(max-width: 48em) 100vw, 100vw" srcset="https://virtualhub.eu.org/media/posts/7/responsive/CPM-80-2.2-MAME-x1-2-xs.png 300w, https://virtualhub.eu.org/media/posts/7/responsive/CPM-80-2.2-MAME-x1-2-sm.png 480w, https://virtualhub.eu.org/media/posts/7/responsive/CPM-80-2.2-MAME-x1-2-md.png 768w" alt="Sharp X1 OS loader screen" width="743" height="576"></figure><p>Press the CAPS LOCK key to enable UI control. Then press the TAB key to open the menu.</p><figure class="post__image post__image--center"><img decoding="async" loading="lazy" src="https://virtualhub.eu.org/media/posts/7/CPM-80-2.2-MAME-x1-3.png" sizes="(max-width: 48em) 100vw, 100vw" srcset="https://virtualhub.eu.org/media/posts/7/responsive/CPM-80-2.2-MAME-x1-3-xs.png 300w, https://virtualhub.eu.org/media/posts/7/responsive/CPM-80-2.2-MAME-x1-3-sm.png 480w, https://virtualhub.eu.org/media/posts/7/responsive/CPM-80-2.2-MAME-x1-3-md.png 768w" alt="Sharp X1 main menu" width="743" height="576"></figure><p>Then click onÂ <code>File Manager &gt; floppydisk1</code>. Choose the <code>disk01.imd</code>Â file from the list and chooseÂ <code>Read-write</code>.</p><figure class="post__image post__image--center"><img decoding="async" loading="lazy" src="https://virtualhub.eu.org/media/posts/7/CPM-80-2.2-MAME-x1-4.png" sizes="(max-width: 48em) 100vw, 100vw" srcset="https://virtualhub.eu.org/media/posts/7/responsive/CPM-80-2.2-MAME-x1-4-xs.png 300w, https://virtualhub.eu.org/media/posts/7/responsive/CPM-80-2.2-MAME-x1-4-sm.png 480w, https://virtualhub.eu.org/media/posts/7/responsive/CPM-80-2.2-MAME-x1-4-md.png 768w" alt="Sharp X1 floppy disk image chooser" width="743" height="576"></figure><p>Then click onÂ <code>Return to Previous menu &gt; Return to the machine</code>. Press the CAPS LOCK key once again to turn off UI control. Press <code>F</code> key and then <code>0</code> key to start CP/M-80 2.2. Enter the following command to install CP/M-80 2.2:</p><pre>movcpm</pre><p>If the the command do not finish within 5 minutes, close you VM and start is again. Enter the <code>DIR</code> command to see a list of files. If it matches the screenshot below, then CP/M-80 2.2 is installed!</p><figure class="post__image post__image--center"><img decoding="async" loading="lazy" src="https://virtualhub.eu.org/media/posts/7/CPM-80-2.2-MAME-x1-5.png" sizes="(max-width: 48em) 100vw, 100vw" srcset="https://virtualhub.eu.org/media/posts/7/responsive/CPM-80-2.2-MAME-x1-5-xs.png 300w, https://virtualhub.eu.org/media/posts/7/responsive/CPM-80-2.2-MAME-x1-5-sm.png 480w, https://virtualhub.eu.org/media/posts/7/responsive/CPM-80-2.2-MAME-x1-5-md.png 768w" alt="List to files in Sharp X1 CP/M-80 2.2" width="730" height="571"></figure><div class="post__entry"><p>Now, you can close this window. The next time you open the emulator again, you don't need to go through all these steps. Just open your terminal and <span style="font-weight: 400;">navigate</span> to the folder where all the the files related to the emulator are stored and run:</p><pre>mame x1</pre><p>You need to prefix the above command with the path to MAME on windows as shown above.</p><p>But this method is very troublesome and lengthy. We can make a shell script which runs the above command on linux:</p><pre>#!/bin/bash<br>mame x1</pre><p>and save the file as CPM-80-x1.sh. Then make the script executable by running the following command in terminal after navigating to that folder:</p><pre>sudo chmod +x ./CPM-80-x1.sh</pre><p>Then we can right click on that file and click on Run as Program to open the emulator. Some DEs and distros may have other methods of running shell scripts.</p><p>On Windows, it is much easier. Create a file called CPM-80-x1.bat in that folder with the following contents:</p><pre>"C:\Program Files\MAME\mame.exe" x1</pre><p>Then double click on that file to launch the emulator.</p><p>That's it. We have installed and run CP/M-80 2.2 using the MAME's Sharp X1 emulation.</p><h2>Troubleshooting</h2><p>First make sure that you have placed the roms files in the correct place. Do not <span style="font-weight: 400;">extract</span> the files. Place the zip files directly in the <code>roms</code> folder.</p><p>On Linux, there might be another error. MAME might have been configured to look in yourÂ <code>~/.mame</code> folder for its config files. If that is the case, running the commandÂ <code>mame</code> without any parameters in the folder where you have stored the files would result in MAME opening in full screen instead of a window. If you are affected by this problem, here is the solution:</p><ul><li>Configure your file manager to show hidden files.</li><li>Go to theÂ <code>~/.mame</code>Â folder.</li><li>Delete theÂ <code>mame.ini</code>Â file there.</li><li>Copy theÂ <code>mame.ini</code>Â file you downloaded from above to that folder.</li></ul><p>TheÂ <code>mame.ini</code> file you downloaded above instructs MAME to look for another mame.ini file in the current folder and use it if found. So, you can then follow the tutorial and everything will work.</p><h3>Some explanation</h3><p>I asked you to replace theÂ <code>mame.ini</code> file with the one you downloaded from here. What are the differences between those files? Here are they:</p><ul><li>It instructs MAME to open in windowed mode instead of full screen.</li><li>It modifies the key needed for enabling UI controls from Scroll Lock to Caps Lock. This is done because many keyboards do not have a Scroll Lock key.</li><li>On Linux, it instructs MAME to first look for <span style="font-weight: 400;">configuration</span> files in the current directory, and if found, use them instead of the one from <code>~/.mame</code>Â folder.</li></ul><p>That is it.</p><h2>Manuals</h2><ul><li><a href="https://web.archive.org/web/20220221170434/http://www.cpm.z80.de/randyfiles/DRI/CPM_2_0_Interface_Guide.pdf" target="_blank" rel="noopener noreferrer">CP/M 2.0 Interface Guide</a></li><li><a href="https://web.archive.org/web/20220221170433/http://www.cpm.z80.de/randyfiles/DRI/CPM_2_0_System_Alteration_Guide.pdf" target="_blank" rel="noopener noreferrer">CP/M 2.0 System Alteration Guide</a></li><li><a href="https://web.archive.org/web/20220324101601/http://www.cpm.z80.de/randyfiles/DRI/CPM_2_0_UG_for_CPM_1_4_Users.pdf" target="_blank" rel="noopener noreferrer">CP/M 2.0 User's Guide for CP/M 1.4 Users</a></li><li><a href="https://web.archive.org/web/20200215062937/http://www.cpm.z80.de/manuals/CPMUserMan.pdf" target="_blank" rel="noopener noreferrer">CP/M User Manual</a></li><li><a href="https://web.archive.org/web/20220121011443/http://www.cpm.z80.de/manuals/cpm22-m.pdf" target="_blank" rel="noopener noreferrer">CP/M 2.2 MANUAL</a></li><li><a href="https://web.archive.org/web/20220324101643/http://www.cpm.z80.de/manuals/SC-CPM.pdf" target="_blank" rel="noopener noreferrer">CP/M Reference Manual</a></li></ul><h2>Some Software</h2><ul><li><a href="https://virtualhub.eu.org/how-to-use-wordmaster-with-sharp-x1-cpm-80-22/" target="_blank" rel="noopener noreferrer">WordMaster</a></li></ul><h2>Related Pages</h2><ul><li><a href="https://winworldpc.com/product/cp-m-80/22" target="_blank" rel="noopener noreferrer">WinWorld Page</a></li><li><a href="https://en.wikipedia.org/wiki/CP/M" target="_blank" rel="noopener noreferrer">Wikipedia</a></li><li><a href="http://www.cpm.z80.de/" target="_blank" rel="noopener noreferrer">The Unofficial CP/M Web site</a></li><li><a href="http://z80.de/ehome.htm" target="_blank" rel="noopener noreferrer">Gaby's Homepage for CP/M and Computer History</a></li><li><a href="http://www.retroarchive.org/cpm" target="_blank" rel="noopener noreferrer">Commercial CP/M Software (Retro Archive)</a></li><li><a href="http://z80.de/ecpmlink.htm" target="_blank" rel="noopener noreferrer">A lots of other links</a></li></ul><h2>Credits</h2><ul><li>TheÂ <a href="https://mamedev.org/" target="_blank" rel="noopener noreferrer">MAME emulator</a>Â is an open source project hosted onÂ <a href="https://github.com/mamedev/mame" target="_blank" rel="noopener noreferrer">github</a>Â developed by MAMEDev and contributors.</li><li>The disk image used above was taken from <a href="https://winworldpc.com/" target="_blank" rel="noopener noreferrer">WinWorld</a>.</li></ul></div></div><footer><p class="post__last-updated">This article was updated on April 8, 2022</p><div class="post__tags-share"><ul class="post__tag"><li><a href="https://virtualhub.eu.org/tags/cpm/">CP/M</a></li><li><a href="https://virtualhub.eu.org/tags/cpm-80/">CP/M-80</a></li><li><a href="https://virtualhub.eu.org/tags/mame/">MAME</a></li></ul><aside class="post__share"><a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fvirtualhub.eu.org%2Fhow-to-experience-cpm-80-22-using-mames-sharp-x1-emulation%2F" class="js-share facebook" aria-label="Share with Facebook" rel="nofollow noopener noreferrer"><svg><use xlink:href="https://virtualhub.eu.org/assets/svg/svg-map.svg#facebook"/></svg> </a><a href="https://twitter.com/share?url=https%3A%2F%2Fvirtualhub.eu.org%2Fhow-to-experience-cpm-80-22-using-mames-sharp-x1-emulation%2F&amp;via=InstallerLegacy&amp;text=How%20to%20experience%20CP%2FM-80%202.2%20using%20MAME's%20Sharp%20X1%20emulation%3F" class="js-share twitter" aria-label="Share with Twitter" rel="nofollow noopener noreferrer"><svg><use xlink:href="https://virtualhub.eu.org/assets/svg/svg-map.svg#twitter"/></svg> </a><a href="https://pinterest.com/pin/create/button/?url=https%3A%2F%2Fvirtualhub.eu.org%2Fhow-to-experience-cpm-80-22-using-mames-sharp-x1-emulation%2F&amp;media=https%3A%2F%2Fvirtualhub.eu.org%2Fmedia%2Fposts%2F7%2FCPM-80-2.2-MAME-x1-5-2.png&amp;description=How%20to%20experience%20CP%2FM-80%202.2%20using%20MAME's%20Sharp%20X1%20emulation%3F" class="js-share pinterest" aria-label="Share with Pinterest" rel="nofollow noopener noreferrer"><svg><use xlink:href="https://virtualhub.eu.org/assets/svg/svg-map.svg#pinterest"/></svg> </a><a href="https://mix.com/add?url=https%3A%2F%2Fvirtualhub.eu.org%2Fhow-to-experience-cpm-80-22-using-mames-sharp-x1-emulation%2F" class="js-share mix" aria-label="Share with Mix" rel="nofollow noopener noreferrer"><svg><use xlink:href="https://virtualhub.eu.org/assets/svg/svg-map.svg#mix"/></svg> </a><a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fvirtualhub.eu.org%2Fhow-to-experience-cpm-80-22-using-mames-sharp-x1-emulation%2F" class="js-share linkedin" aria-label="Share with LinkedIn" rel="nofollow noopener noreferrer"><svg><use xlink:href="https://virtualhub.eu.org/assets/svg/svg-map.svg#linkedin"/></svg> </a><a href="https://buffer.com/add?text=How%20to%20experience%20CP%2FM-80%202.2%20using%20MAME's%20Sharp%20X1%20emulation%3F&amp;url=https%3A%2F%2Fvirtualhub.eu.org%2Fhow-to-experience-cpm-80-22-using-mames-sharp-x1-emulation%2F" class="js-share buffer" aria-label="Share with Buffer" rel="nofollow noopener noreferrer"><svg><use xlink:href="https://virtualhub.eu.org/assets/svg/svg-map.svg#buffer"/></svg> </a><a href="https://api.whatsapp.com/send?text=How%20to%20experience%20CP%2FM-80%202.2%20using%20MAME's%20Sharp%20X1%20emulation%3F https%3A%2F%2Fvirtualhub.eu.org%2Fhow-to-experience-cpm-80-22-using-mames-sharp-x1-emulation%2F" class="js-share whatsapp" aria-label="Share with WhatsApp" rel="nofollow noopener noreferrer"><svg class="icon" aria-hidden="true" focusable="false"><use xlink:href="https://virtualhub.eu.org/assets/svg/svg-map.svg#whatsapp"/></svg></a></aside></div><div class="post__bio author"><img src="https://www.gravatar.com/avatar/f30bdb8765107442ed532bd910da7a5a?s&#x3D;240" loading="lazy" height="240" width="240" class="author__avatar" alt="Legacy Installer"><div><h3 class="h6 author__name"><a href="https://virtualhub.eu.org/authors/legacy-installer/" class="invert" title="Legacy Installer">Legacy Installer</a></h3><p class="author__desc">The installer of age-old operating systems in different virtual environments and emulators.</p></div></div><nav class="post__nav"><div class="post__nav__prev"><a class="post__nav__link" href="https://virtualhub.eu.org/how-to-experience-cpm-80-22-using-mame-kaypro-ii-emulation/" rel="prev">Previous Post<h3 class="h6">How to experience CP/M-80 2.2 using MAME&#x27;s KAYPRO II emulation?</h3></a></div><div class="post__nav__next"><a class="post__nav__link" href="https://virtualhub.eu.org/how-to-experience-cpm-80-22-using-mames-ncr-decision-mate-v-emulation/" rel="prev">Next Post<h3 class="h6">How to experience CP/M-80 2.2 using MAME&#x27;s NCR Decision Mate V emulation?</h3></a></div></nav></footer></div></article><div class="comments-area post__inner" id="comments"><div class="comments"><div class="comments-wrapper"><h2>Comments</h2><div id="cusdis_thread" data-host="https://cusdis.com" data-app-id="0c898ee8-a6a5-4466-9f0b-52ce10c46166" data-page-id="7" data-page-url="https://virtualhub.eu.org/how-to-experience-cpm-80-22-using-mames-sharp-x1-emulation/" data-page-title="How to experience CP/M-80 2.2 using MAME's Sharp X1 emulation?" data-theme="auto"></div><noscript>Please enable JS to use the comments form.</noscript><div data-gdpr-group="gdpr-blocker/comments" id="cusdis-no-consent-info" style="background: #f0f0f0; border: 1px solid #ccc; border-radius: 5px; color: #666; display: block; padding: 10px; text-align: center; width: 100%;">Comments are disabled because you have not consented to their use. You can change your cookie preferences via our 'cookie banner'.</div><script type="gdpr-blocker/comments">var cusdis_element_to_check = document.getElementById('cusdis_thread');

				if ('IntersectionObserver' in window) {
					var iObserver = new IntersectionObserver(
						(entries, observer) => {
							entries.forEach(entry => {
								if (entry.intersectionRatio >= 0.1) {
									(function () {
										var d = document, s = d.createElement('script');
										s.defer = true;
										s.src = 'https://cusdis.com/js/cusdis.es.js';									
										(d.head || d.body).appendChild(s);
									})();
									observer.unobserve(entry.target);
								}
							});
						},
						{
							threshold: [0, 0.2, 0.5, 1]
						}
					);

					iObserver.observe(cusdis_element_to_check);
				} else {
					(function () {
						var d = document, s = d.createElement('script');
						s.defer = true;
						s.src = 'https://cusdis.com/js/cusdis.es.js';
						(d.head || d.body).appendChild(s);
					})();
				}</script><script type="text/javascript">document.body.addEventListener('publii-cookie-banner-unblock-comments', function () {
				document.getElementById('cusdis-no-consent-info').style.display = 'none';
			}, false);</script></div></div></div></div><div class="post__related"><div class="wrapper"><h2 class="h5">Related posts</h2><div class="l-grid l-grid--4"><article class="c-card"><a href="https://virtualhub.eu.org/how-to-install-multiplan-106-on-cpm-80-22/" class="c-card__image"><img src="https://virtualhub.eu.org/media/posts/12/Multiplan-1.06-CPM-Altair-Z80-1-2.png" srcset="https://virtualhub.eu.org/media/posts/12/responsive/Multiplan-1.06-CPM-Altair-Z80-1-2-xs.png 300w, https://virtualhub.eu.org/media/posts/12/responsive/Multiplan-1.06-CPM-Altair-Z80-1-2-sm.png 480w, https://virtualhub.eu.org/media/posts/12/responsive/Multiplan-1.06-CPM-Altair-Z80-1-2-md.png 768w, https://virtualhub.eu.org/media/posts/12/responsive/Multiplan-1.06-CPM-Altair-Z80-1-2-lg.png 1200w" sizes="(min-width: 56.25em) 100vw, (min-width: 37.5em) 50vw, 100vw" loading="lazy" height="630" width="834" alt="Multiplan 1.06 for CP/M-80 2.2"></a><div class="c-card__wrapper"><header class="c-card__header"><div class="c-card__tag"><a href="https://virtualhub.eu.org/tags/application/">Application</a></div><h3 class="c-card__title"><a href="https://virtualhub.eu.org/how-to-install-multiplan-106-on-cpm-80-22/" class="invert">How to install Multiplan 1.06 on CP/M-80 2.2?</a></h3></header><footer class="c-card__meta"><time datetime="2022-04-01T12:00">April 1, 2022</time></footer></div></article><article class="c-card"><a href="https://virtualhub.eu.org/how-to-install-wordstar-40-on-cpm-80-22/" class="c-card__image"><img src="https://virtualhub.eu.org/media/posts/11/WordStar-4.0-CPM-Altair-Z80-2-2.png" srcset="https://virtualhub.eu.org/media/posts/11/responsive/WordStar-4.0-CPM-Altair-Z80-2-2-xs.png 300w, https://virtualhub.eu.org/media/posts/11/responsive/WordStar-4.0-CPM-Altair-Z80-2-2-sm.png 480w, https://virtualhub.eu.org/media/posts/11/responsive/WordStar-4.0-CPM-Altair-Z80-2-2-md.png 768w, https://virtualhub.eu.org/media/posts/11/responsive/WordStar-4.0-CPM-Altair-Z80-2-2-lg.png 1200w" sizes="(min-width: 56.25em) 100vw, (min-width: 37.5em) 50vw, 100vw" loading="lazy" height="630" width="834" alt="Sample file on WordStar 4.0"></a><div class="c-card__wrapper"><header class="c-card__header"><div class="c-card__tag"><a href="https://virtualhub.eu.org/tags/application/">Application</a></div><h3 class="c-card__title"><a href="https://virtualhub.eu.org/how-to-install-wordstar-40-on-cpm-80-22/" class="invert">How to install WordStar 4.0 on CP/M-80 2.2?</a></h3></header><footer class="c-card__meta"><time datetime="2022-03-31T12:00">March 31, 2022</time></footer></div></article><article class="c-card"><a href="https://virtualhub.eu.org/how-to-install-wordstar-33-on-cpm-80-22/" class="c-card__image"><img src="https://virtualhub.eu.org/media/posts/10/WordStar-3.3-CPM-Altair-Z80-1-2.png" srcset="https://virtualhub.eu.org/media/posts/10/responsive/WordStar-3.3-CPM-Altair-Z80-1-2-xs.png 300w, https://virtualhub.eu.org/media/posts/10/responsive/WordStar-3.3-CPM-Altair-Z80-1-2-sm.png 480w, https://virtualhub.eu.org/media/posts/10/responsive/WordStar-3.3-CPM-Altair-Z80-1-2-md.png 768w, https://virtualhub.eu.org/media/posts/10/responsive/WordStar-3.3-CPM-Altair-Z80-1-2-lg.png 1200w" sizes="(min-width: 56.25em) 100vw, (min-width: 37.5em) 50vw, 100vw" loading="lazy" height="630" width="834" alt="WordStar 3.3 on CP/M-80 2.2 on Altair Z80 emulator"></a><div class="c-card__wrapper"><header class="c-card__header"><div class="c-card__tag"><a href="https://virtualhub.eu.org/tags/application/">Application</a></div><h3 class="c-card__title"><a href="https://virtualhub.eu.org/how-to-install-wordstar-33-on-cpm-80-22/" class="invert">How to install WordStar 3.3 on CP/M-80 2.2?</a></h3></header><footer class="c-card__meta"><time datetime="2022-03-30T12:00">March 30, 2022</time></footer></div></article><article class="c-card"><a href="https://virtualhub.eu.org/how-to-experience-cpm-80-22-using-yaze/" class="c-card__image"><img src="https://virtualhub.eu.org/media/posts/9/CPM-80-2.2-YAZE-3-2.png" srcset="https://virtualhub.eu.org/media/posts/9/responsive/CPM-80-2.2-YAZE-3-2-xs.png 300w, https://virtualhub.eu.org/media/posts/9/responsive/CPM-80-2.2-YAZE-3-2-sm.png 480w, https://virtualhub.eu.org/media/posts/9/responsive/CPM-80-2.2-YAZE-3-2-md.png 768w, https://virtualhub.eu.org/media/posts/9/responsive/CPM-80-2.2-YAZE-3-2-lg.png 1200w" sizes="(min-width: 56.25em) 100vw, (min-width: 37.5em) 50vw, 100vw" loading="lazy" height="630" width="834" alt="List of FIles in YAZE CP/M-80 2.2"></a><div class="c-card__wrapper"><header class="c-card__header"><div class="c-card__tag"><a href="https://virtualhub.eu.org/tags/cpm/">CP/M</a></div><h3 class="c-card__title"><a href="https://virtualhub.eu.org/how-to-experience-cpm-80-22-using-yaze/" class="invert">How to experience CP/M-80 2.2 using YAZE?</a></h3></header><footer class="c-card__meta"><time datetime="2022-03-29T12:00">March 29, 2022</time></footer></div></article></div></div></div></main><footer class="footer"><div class="footer__social"><a href="https://www.facebook.com/installerlegacy" aria-label="Facebook" class="facebook"><svg><use xlink:href="https://virtualhub.eu.org/assets/svg/svg-map.svg#facebook"/></svg> </a><a href="https://twitter.com/InstallerLegacy" aria-label="Twitter" class="twitter"><svg><use xlink:href="https://virtualhub.eu.org/assets/svg/svg-map.svg#twitter"/></svg> </a><a href="https://www.instagram.com/installerlegacy" aria-label="Instagram" class="instagram"><svg><use xlink:href="https://virtualhub.eu.org/assets/svg/svg-map.svg#instagram"/></svg> </a><a href="https://vimeo.com/legacyinstaller" aria-label="Vimeo" class="vimeo"><svg><use xlink:href="https://virtualhub.eu.org/assets/svg/svg-map.svg#vimeo"/></svg> </a><a href="https://www.youtube.com/channel/UC-I8rYuX1N17jcwboU3104Q" aria-label="Youtube" class="youtube"><svg><use xlink:href="https://virtualhub.eu.org/assets/svg/svg-map.svg#youtube"/></svg></a></div><div class="footer__copyright">Powered by Legacy Installer - https://legacyinstaller.pcriot.com</div></footer><script>window.publiiThemeMenuConfig = {    
      mobileMenuMode: 'sidebar',
      animationSpeed: 300,
      submenuWidth: 'auto',
      doubleClickTime: 500,
      mobileMenuExpandableSubmenus: true, 
      relatedContainerForOverlayMenuSelector: '.navbar',
   };</script><script defer="defer" src="https://virtualhub.eu.org/assets/js/scripts.min.js?v=66112a161d5939d966ce2b20c13988d9"></script><script>var images = document.querySelectorAll('img[loading]');

      for (var i = 0; i < images.length; i++) {
         if (images[i].complete) {
               images[i].classList.add('is-loaded');
         } else {
               images[i].addEventListener('load', function () {
                  this.classList.add('is-loaded');
               }, false);
         }
      }</script><div class="pcb" data-behaviour="badge" data-behaviour-link="#cookie-settings" data-revision="1" data-config-ttl="90" data-debug-mode="false"><div role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="pcb-title" aria-describedby="pcb-txt" class="pcb__banner pcb__banner--left"><div class="pcb__inner"><div id="pcb-title" role="heading" class="pcb__title">This website uses cookies</div><div id="pcb-txt" class="pcb__txt">Select which cookies to opt-in to via the checkboxes below; our website uses cookies to examine site traffic and user activity while on our site, for marketing, and to provide social media functionality. <a href="https://legacyinstaller.pcriot.com/privacy-policy">More details...</a></div><div class="pcb__buttons"><button type="button" class="pcb__btn pcb__btn--link pcb__btn--configure" aria-haspopup="dialog">Manage preferences</button> <button type="button" class="pcb__btn pcb__btn--solid pcb__btn--accept">Save</button></div></div></div><div class="pcb__popup" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="pcb-popup-title"><div class="pcb__popup__wrapper"><div class="pcb__inner pcb__popup__inner"><div class="pcb__popup__heading"><div id="pcb-popup-title" role="heading" class="pcb__title">Cookie settings</div><button class="pcb__popup__close" aria-label="Close"></button></div><div class="pcb__popup__content"><div class="pcb__txt pcb__popup__txt">We use cookies to enhance your browsing experience, serve personalized ads or content, and analyze our traffic. By clicking "Accept All", you consent to our use of cookies. <a href="https://legacyinstaller.pcriot.com/privacy-policy">More details...</a></div><ul class="pcb__groups"><li class="pcb__group"><details><summary class="pcb__group__title no-desc">Required</summary></details><div class="pcb__popup__switch is-checked"><input type="checkbox" data-group-name="" id="pcb-group-0" checked="checked"> <label for="pcb-group-0">Required</label></div></li><li class="pcb__group"><details><summary class="pcb__group__title no-desc">Functionality</summary></details><div class="pcb__popup__switch"><input type="checkbox" data-group-name="functionality" id="functionality-cookies"> <label for="functionality-cookies">Functionality</label></div></li><li class="pcb__group"><details><summary class="pcb__group__title no-desc">Analytical</summary></details><div class="pcb__popup__switch"><input type="checkbox" data-group-name="analytics" id="analytics-cookies"> <label for="analytics-cookies">Analytical</label></div></li><li class="pcb__group"><details><summary class="pcb__group__title no-desc">Marketing</summary></details><div class="pcb__popup__switch"><input type="checkbox" data-group-name="marketing" id="marketing-cookies"> <label for="marketing-cookies">Marketing</label></div></li><li class="pcb__group"><details><summary class="pcb__group__title no-desc">Comments</summary></details><div class="pcb__popup__switch"><input type="checkbox" data-group-name="comments" id="comments-cookies"> <label for="comments-cookies">Comments</label></div></li></ul></div><div class="pcb__buttons pcb__popup__buttons"><button type="button" class="pcb__btn pcb__btn--solid pcb__btn--accept">Accept all</button> <button type="button" class="pcb__btn pcb__btn--reject">Reject all</button> <button type="button" class="pcb__btn pcb__btn--save">Save settings</button></div></div></div></div><div class="pcb__overlay" aria-hidden="true"></div><button class="pcb__badge" aria-label="Cookie Policy" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" width="40" height="40" viewBox="0 0 23 23" fill="currentColor"><path d="M21.41 12.71c-.08-.01-.15 0-.22 0h-.03c-.03 0-.05 0-.08.01-.07 0-.13.01-.19.04-.52.21-1.44.19-2.02-.22-.44-.31-.65-.83-.62-1.53a.758.758 0 0 0-.27-.61.73.73 0 0 0-.65-.14c-1.98.51-3.49.23-4.26-.78-.82-1.08-.73-2.89.24-4.49.14-.23.14-.52 0-.75a.756.756 0 0 0-.67-.36c-.64.03-1.11-.1-1.31-.35-.19-.26-.13-.71-.01-1.29.04-.18.06-.38.03-.59-.05-.4-.4-.7-.81-.66C5.1 1.54 1 6.04 1 11.48 1 17.28 5.75 22 11.6 22c5.02 0 9.39-3.54 10.39-8.42.08-.4-.18-.78-.58-.87Zm-9.81 7.82c-5.03 0-9.12-4.06-9.12-9.06 0-4.34 3.05-8 7.25-8.86-.08.7.05 1.33.42 1.81.24.32.66.67 1.38.84-.76 1.86-.65 3.78.36 5.11.61.81 2.03 2 4.95 1.51.18.96.71 1.54 1.18 1.87.62.43 1.38.62 2.1.62.05 0 .09 0 .13-.01-1.23 3.64-4.7 6.18-8.64 6.18ZM13 17c0 .55-.45 1-1 1s-1-.45-1-1 .45-1 1-1 1 .45 1 1Zm5.29-12.3a.99.99 0 0 1-.29-.71c0-.55.45-.99 1-.99a1 1 0 0 1 .71.3c.19.19.29.44.29.71 0 .55-.45.99-1 .99a1 1 0 0 1-.71-.3ZM9 13.5c0 .83-.67 1.5-1.5 1.5S6 14.33 6 13.5 6.67 12 7.5 12s1.5.67 1.5 1.5Zm3.25.81a.744.744 0 0 1-.06-1.05c.28-.32.75-.34 1.05-.06.31.28.33.75.05 1.06-.15.16-.35.25-.56.25-.18 0-.36-.06-.5-.19ZM8.68 7.26c.41.37.44 1 .07 1.41-.2.22-.47.33-.75.33a.96.96 0 0 1-.67-.26c-.41-.37-.44-1-.07-1.41.37-.42 1-.45 1.41-.08Zm11.48 1.88c.18-.19.52-.19.7 0 .05.04.09.1.11.16.03.06.04.12.04.19 0 .13-.05.26-.15.35-.09.1-.22.15-.35.15s-.26-.05-.35-.15a.355.355 0 0 1-.11-.16.433.433 0 0 1-.04-.19c0-.13.05-.26.15-.35Zm-4.93-1.86a.75.75 0 1 1 1.059-1.06.75.75 0 0 1-1.059 1.06Z"/></svg></button></div><script>(function(win) {
    if (!document.querySelector('.pcb')) {
        return;
    }

    var cbConfig = {
        behaviour: document.querySelector('.pcb').getAttribute('data-behaviour'),
        behaviourLink: document.querySelector('.pcb').getAttribute('data-behaviour-link'),
        revision: document.querySelector('.pcb').getAttribute('data-revision'),
        configTTL: parseInt(document.querySelector('.pcb').getAttribute('data-config-ttl'), 10),
        debugMode: document.querySelector('.pcb').getAttribute('data-debug-mode') === 'true',
        initialState: null,
        previouslyAccepted: []
    };

    var cbUI = {
        wrapper: document.querySelector('.pcb'),
        banner: {
            element: null,
            btnAccept: null,
            btnReject: null,
            btnConfigure: null
        },
        popup: {
            element: null,
            btnClose: null,
            btnSave: null,
            btnAccept: null,
            btnReject: null,
            checkboxes: null,
        },
        overlay: null,
        badge: null,
        blockedScripts: document.querySelectorAll('script[type^="gdpr-blocker/"]'),
        triggerLinks: cbConfig.behaviourLink ? document.querySelectorAll('a[href*="' + cbConfig.behaviourLink + '"]') : null
    };

    function initUI () {
        // setup banner elements
        cbUI.banner.element = cbUI.wrapper.querySelector('.pcb__banner');
        cbUI.banner.btnAccept = cbUI.banner.element.querySelector('.pcb__btn--accept');
        cbUI.banner.btnReject = cbUI.banner.element.querySelector('.pcb__btn--reject');
        cbUI.banner.btnConfigure = cbUI.banner.element.querySelector('.pcb__btn--configure');

        // setup popup elements
        if (cbUI.wrapper.querySelector('.pcb__popup')) {
            cbUI.popup.element = cbUI.wrapper.querySelector('.pcb__popup');
            cbUI.popup.btnClose = cbUI.wrapper.querySelector('.pcb__popup__close');
            cbUI.popup.btnSave = cbUI.popup.element.querySelector('.pcb__btn--save');
            cbUI.popup.btnAccept = cbUI.popup.element.querySelector('.pcb__btn--accept');
            cbUI.popup.btnReject = cbUI.popup.element.querySelector('.pcb__btn--reject');
            cbUI.popup.checkboxes = cbUI.popup.element.querySelector('input[type="checkbox"]');
            // setup overlay
            cbUI.overlay = cbUI.wrapper.querySelector('.pcb__overlay');
        }

        cbUI.badge = cbUI.wrapper.querySelector('.pcb__badge');

        if (cbConfig.behaviour.indexOf('link') > -1) {
            for (var i = 0; i < cbUI.triggerLinks.length; i++) {
                cbUI.triggerLinks[i].addEventListener('click', function(e) {
                    e.preventDefault();
                    showBannerOrPopup();
                });
            }
        }
    }

    function initState () {
        var lsKeyName = getConfigName();
        var currentConfig = localStorage.getItem(lsKeyName);
        var configIsFresh = checkIfConfigIsFresh();

        if (!configIsFresh || currentConfig === null) {
            if (cbConfig.debugMode) {
                console.log('ðŸª Config not found, or configuration expired');
            }

            showBanner();
        } else if (typeof currentConfig === 'string') {
            if (cbConfig.debugMode) {
                console.log('ðŸª Config founded');
            }

            showBadge();

            if (cbUI.popup.element) {
                var allowedGroups = currentConfig.split(',');
                var checkedCheckboxes = cbUI.popup.element.querySelectorAll('input[type="checkbox"]:checked');

                for (var j = 0; j < checkedCheckboxes.length; j++) {
                    var name = checkedCheckboxes[j].getAttribute('data-group-name');

                    if (name && name !== '-' && allowedGroups.indexOf(name) === -1) {
                        checkedCheckboxes[j].checked = false;
                    }
                }

                for (var i = 0; i < allowedGroups.length; i++) {
                    var checkbox = cbUI.popup.element.querySelector('input[type="checkbox"][data-group-name="' + allowedGroups[i] + '"]');

                    if (checkbox) {
                        checkbox.checked = true;
                    }

                    allowCookieGroup(allowedGroups[i]);
                }
            }
        }

        setTimeout(function () {
            cbConfig.initialState = getInitialStateOfConsents();
        }, 0);
    }

    function checkIfConfigIsFresh () {
        var lastConfigSave = localStorage.getItem('publii-gdpr-cookies-config-save-date');

        if (lastConfigSave === null) {
            return false;
        }

        lastConfigSave = parseInt(lastConfigSave, 10);

        if (lastConfigSave === 0) {
            return true;
        }

        if (+new Date() - lastConfigSave < cbConfig.configTTL * 24 * 60 * 60 * 1000) {
            return true;
        }

        return false;
    }

    function initBannerEvents () {
        cbUI.banner.btnAccept.addEventListener('click', function (e) {
            e.preventDefault();
            acceptAllCookies('banner');
            showBadge();
        }, false);

        if (cbUI.banner.btnReject) {
            cbUI.banner.btnReject.addEventListener('click', function (e) {
                e.preventDefault();
                rejectAllCookies();
                showBadge();
            }, false);
        }

        if (cbUI.banner.btnConfigure) {
            cbUI.banner.btnConfigure.addEventListener('click', function (e) {
                e.preventDefault();
                hideBanner();
                showAdvancedPopup();
                showBadge();
            }, false);
        }
    }

    function initPopupEvents () {
        if (!cbUI.popup.element) {
            return;
        }

        cbUI.overlay.addEventListener('click', function (e) {
            hideAdvancedPopup();
        }, false);

        cbUI.popup.element.addEventListener('click', function (e) {
            e.stopPropagation();
        }, false);

        cbUI.popup.btnAccept.addEventListener('click', function (e) {
            e.preventDefault();
            acceptAllCookies('popup');
        }, false);

        cbUI.popup.btnReject.addEventListener('click', function (e) {
            e.preventDefault();
            rejectAllCookies();
        }, false);

        cbUI.popup.btnSave.addEventListener('click', function (e) {
            e.preventDefault();
            saveConfiguration();
        }, false);

        cbUI.popup.btnClose.addEventListener('click', function (e) {
            e.preventDefault();
            hideAdvancedPopup();
        }, false);
    }

    function initBadgeEvents () {
        if (!cbUI.badge) {
            return;
        }

        cbUI.badge.addEventListener('click', function (e) {
            showBannerOrPopup();
        }, false);
    }

    initUI();
    initState();
    initBannerEvents();
    initPopupEvents();
    initBadgeEvents();

    /**
     * API
     */
    function addScript (src, inline) {
        var newScript = document.createElement('script');

        if (src) {
            newScript.setAttribute('src', src);
        }

        if (inline) {
            newScript.text = inline;
        }

        document.body.appendChild(newScript);
    }

    function allowCookieGroup (allowedGroup) {
        var scripts = document.querySelectorAll('script[type="gdpr-blocker/' + allowedGroup + '"]');
        cbConfig.previouslyAccepted.push(allowedGroup);
    
        for (var j = 0; j < scripts.length; j++) {
            addScript(scripts[j].src, scripts[j].text);
        }

        var groupEvent = new Event('publii-cookie-banner-unblock-' + allowedGroup);
        document.body.dispatchEvent(groupEvent);
        unlockEmbeds(allowedGroup);

        if (cbConfig.debugMode) {
            console.log('ðŸª Allowed group: ' + allowedGroup);
        }
    }

    function showBannerOrPopup () {
        if (cbUI.popup.element) {
            showAdvancedPopup();
        } else {
            showBanner();
        }
    }

    function showAdvancedPopup () {
        cbUI.popup.element.classList.add('is-visible');
        cbUI.overlay.classList.add('is-visible');
        cbUI.popup.element.setAttribute('aria-hidden', 'false');
        cbUI.overlay.setAttribute('aria-hidden', 'false');
    }

    function hideAdvancedPopup () {
        cbUI.popup.element.classList.remove('is-visible');
        cbUI.overlay.classList.remove('is-visible');
        cbUI.popup.element.setAttribute('aria-hidden', 'true');
        cbUI.overlay.setAttribute('aria-hidden', 'true');
    }

    function showBanner () {
        cbUI.banner.element.classList.add('is-visible');
        cbUI.banner.element.setAttribute('aria-hidden', 'false');
    }

    function hideBanner () {
        cbUI.banner.element.classList.remove('is-visible');
        cbUI.banner.element.setAttribute('aria-hidden', 'true');
    }

    function showBadge () {
        if (!cbUI.badge) {
            return;
        }

        cbUI.badge.classList.add('is-visible');
        cbUI.badge.setAttribute('aria-hidden', 'false');
    }

    function getConfigName () {
        var lsKeyName = 'publii-gdpr-allowed-cookies';

        if (cbConfig.revision) {
            lsKeyName = lsKeyName + '-v' + parseInt(cbConfig.revision, 10);
        }

        return lsKeyName;
    }

    function storeConfiguration (allowedGroups) {
        var lsKeyName = getConfigName();
        var dataToStore = allowedGroups.join(',');
        localStorage.setItem(lsKeyName, dataToStore);

        if (cbConfig.configTTL === 0) {
            localStorage.setItem('publii-gdpr-cookies-config-save-date', 0);

            if (cbConfig.debugMode) {
                console.log('ðŸª Store never expiring configuration');
            }
        } else {
            localStorage.setItem('publii-gdpr-cookies-config-save-date', +new Date());
        }
    }

    function getInitialStateOfConsents () {
        if (!cbUI.popup.element) {
            return [];
        }

        var checkedGroups = cbUI.popup.element.querySelectorAll('input[type="checkbox"]:checked');
        var groups = [];

        for (var i = 0; i < checkedGroups.length; i++) {
            var allowedGroup = checkedGroups[i].getAttribute('data-group-name');

            if (allowedGroup !== '') {
                groups.push(allowedGroup);
            }
        }

        if (cbConfig.debugMode) {
            console.log('ðŸª Initial state: ' + groups.join(', '));
        }

        return groups;
    }

    function getCurrentStateOfConsents () {
        if (!cbUI.popup.element) {
            return [];
        }

        var checkedGroups = cbUI.popup.element.querySelectorAll('input[type="checkbox"]:checked');
        var groups = [];

        for (var i = 0; i < checkedGroups.length; i++) {
            var allowedGroup = checkedGroups[i].getAttribute('data-group-name');

            if (allowedGroup !== '') {
                groups.push(allowedGroup);
            }
        }

        if (cbConfig.debugMode) {
            console.log('ðŸª State to save: ' + groups.join(', '));
        }

        return groups;
    }

    function getAllGroups () {
        if (!cbUI.popup.element) {
            return [];
        }

        var checkedGroups = cbUI.popup.element.querySelectorAll('input[type="checkbox"]');
        var groups = [];

        for (var i = 0; i < checkedGroups.length; i++) {
            var allowedGroup = checkedGroups[i].getAttribute('data-group-name');

            if (allowedGroup !== '') {
                groups.push(allowedGroup);
            }
        }

        return groups;
    }

    function acceptAllCookies (source) {
        var groupsToAccept = getAllGroups();
        storeConfiguration(groupsToAccept);

        for (var i = 0; i < groupsToAccept.length; i++) {
            var group = groupsToAccept[i];

            if (cbConfig.initialState.indexOf(group) > -1 || cbConfig.previouslyAccepted.indexOf(group) > -1) {
                if (cbConfig.debugMode) {
                    console.log('ðŸª Skip previously activated group: ' + group);
                }

                continue;
            }

            allowCookieGroup(group);
        }

        if (cbUI.popup.element) {
            var checkboxesToCheck = cbUI.popup.element.querySelectorAll('input[type="checkbox"]');

            for (var j = 0; j < checkboxesToCheck.length; j++) {
                checkboxesToCheck[j].checked = true;
            }
        }

        if (cbConfig.debugMode) {
            console.log('ðŸª Accept all cookies: ', groupsToAccept.join(', '));
        }

        if (source === 'popup') {
            hideAdvancedPopup();
        } else if (source === 'banner') {
            hideBanner();
        }
    }

    function rejectAllCookies () {
        if (cbConfig.debugMode) {
            console.log('ðŸª Reject all cookies');
        }

        storeConfiguration([]);
        setTimeout(function () {
            window.location.reload();
        }, 100);
    }

    function saveConfiguration () {
        var groupsToAccept = getCurrentStateOfConsents();
        storeConfiguration(groupsToAccept);

        if (cbConfig.debugMode) {
            console.log('ðŸª Save new config: ', groupsToAccept.join(', '));
        }

        if (reloadIsNeeded(groupsToAccept)) {
            setTimeout(function () {
                window.location.reload();
            }, 100);
            return;
        }

        for (var i = 0; i < groupsToAccept.length; i++) {
            var group = groupsToAccept[i];

            if (cbConfig.initialState.indexOf(group) > -1 || cbConfig.previouslyAccepted.indexOf(group) > -1) {
                if (cbConfig.debugMode) {
                    console.log('ðŸª Skip previously activated group: ' + group);
                }

                continue;
            }

            allowCookieGroup(group);
        }

        hideAdvancedPopup();
    }

    function reloadIsNeeded (groupsToAccept) {
        // check if user rejected consent for initial groups
        var initialGroups = cbConfig.initialState;
        var previouslyAcceptedGroups = cbConfig.previouslyAccepted;
        var groupsToCheck = initialGroups.concat(previouslyAcceptedGroups);

        for (var i = 0; i < groupsToCheck.length; i++) {
            var groupToCheck = groupsToCheck[i];

            if (groupsToAccept.indexOf(groupToCheck) === -1) {
                if (cbConfig.debugMode) {
                    console.log('ðŸª Reload is needed due lack of: ', groupToCheck);
                }

                return true;
            }
        }

        return false;
    }

    function unlockEmbeds (cookieGroup) {
        var iframesToUnlock = document.querySelectorAll('.pec-wrapper[data-consent-group-id="' + cookieGroup + '"]');

        for (var i = 0; i < iframesToUnlock.length; i++) {
            var iframeWrapper = iframesToUnlock[i];
            iframeWrapper.querySelector('.pec-overlay').classList.remove('is-active');
            iframeWrapper.querySelector('.pec-overlay').setAttribute('aria-hidden', 'true');
            var iframe = iframeWrapper.querySelector('iframe');
            iframe.setAttribute('src', iframe.getAttribute('data-consent-src'));
        }
    }

    win.publiiEmbedConsentGiven = function (cookieGroup) {
        // it will unlock embeds
        allowCookieGroup(cookieGroup);

        var checkbox = cbUI.popup.element.querySelector('input[type="checkbox"][data-group-name="' + cookieGroup + '"]');

        if (checkbox) {
            checkbox.checked = true;
        }

        var groupsToAccept = getCurrentStateOfConsents();
        storeConfiguration(groupsToAccept);

        if (cbConfig.debugMode) {
            console.log('ðŸª Save new config: ', groupsToAccept.join(', '));
        }
    }
})(window);</script></body></html>